---
title: "."
author: " "
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
    source_code: embed
  runtime: shiny
---


<!-- https://titouanlegourrierec.shinyapps.io/projet_visu/ -->


<!-- rsconnect::setAccountInfo(name='titouanlegourrierec', token='7319AF2A3409D2CA5422D00C6C109B28', secret='ZiP5VjMrdnrD2SKFIi8GcXRXG/Zl9XlwwbjnNKgD') -->
<!-- setwd("/Users/titouanlegourrierec/Desktop/Shiny_Projet_Visu") -->
<!-- rsconnect::deployApp() -->


```{r setup, include=FALSE}
# Chargement des biblioth√®ques
library(flexdashboard)
#library(shiny)
library(dplyr)
library(tidyr)
library(ggplot2)
library(plotly)
#library(reshape2)
#library(rAmCharts)
#library(rpart)
library(sf)
library(readr)
library(stringr)
library(leaflet)
#library(RColorBrewer)
library(DT)
```


```{r r√©cup√©ration des donn√©es, echo=FALSE}

################       D√©coupage des d√©partements fran√ßais      ################

# Lire les donn√©es du shapefile pour les d√©partements fran√ßais
france <- st_read("./France_shape/departements-20140306-100m.shp", quiet=T)

# Supprimer les colonnes inutiles du dataframe 'france'
france <- france[, !names(france) %in% c("nom", "nuts3", "wikipedia")]

################################################################################


################     R√©cup√©ration des donn√©es de population     ################

# Lire les donn√©es de population pour les d√©partements fran√ßais
pop <- read_csv("./Populations_Departements/Departements.csv")

# Supprimer la premi√®re colonne du dataframe 'pop'
pop <- pop[, -1]

# Effectuer une jointure interne entre les dataframes 'france' et 'pop' bas√©e sur la colonne 'code_insee'
carte_filtree <- inner_join(france, pop, by = "code_insee")

# Calculer les aires des d√©partements et les convertir en kilom√®tres carr√©s
carte_filtree <- carte_filtree %>% mutate(aires = st_area(.))  
carte_filtree <- carte_filtree %>% mutate(aires = as.numeric(str_extract(aires, "\\d+")) / 1E6)

# Calculer la densit√© de population
carte_filtree["Densit√©"] <- carte_filtree["pop"]/carte_filtree["aires"]

################################################################################


########     R√©cup√©ration des donn√©es des INFRASTRUCTURES sportives    #########

# Lire les donn√©es d'√©quipement sportif
sport_equipment <- read_csv("./Sport_Equipment/Sport_Equipment.csv")
sport_equipment <- sport_equipment[, !names(sport_equipment) %in% c("...1")]

################################################################################



###########     R√©cup√©ration des donn√©es des LICENCES sportives    #############

# Lire les donn√©es de licences sportives
licences <-  read_csv("./Licences/AllPages.csv")
licences <- licences[, -1]

################################################################################

# Effectuer une jointure interne entre les dataframes 'carte_filtree' et 'sport_equipment' bas√©e sur la colonne 'code_insee'
carte_sport <- inner_join(carte_filtree, sport_equipment, by = "code_insee")

# Effectuer une jointure interne entre les dataframes 'carte_sport' et 'licences' bas√©e sur la colonne 'code_insee'
carte_sport <- inner_join(carte_sport, licences, by = "code_insee")

# Cr√©er une nouvelle colonne 'code_nom' en combinant le code INSEE et le nom du d√©partement
carte_sport$code_nom <- paste(carte_sport$code_insee, carte_sport$nom, sep = " - ")

# Lire les donn√©es sur l'√©volution des licences
evolution <- read_csv2("./Evolution_Licences/Licences_evolution.csv")
```



```{r formattage popup d√©partements carte}
# D√©finir une fonction pour g√©n√©rer le contenu de la popup pour chaque d√©partement
popup_content <- function(properties, object) {
  
  # Extraire les donn√©es des infrastructures, des licences et de l'√¢ge des infrastructures pour l'objet sp√©cifi√©
  eval(parse(text = paste0("object2 <- carte_sport$", paste0("Infrastructures_", object))))
  eval(parse(text = paste0("object3 <- carte_sport$", paste0("Licences_", object))))
  eval(parse(text = paste0("object4 <- carte_sport$", paste0("AgeInfrastructures_", object))))
  
  # Supprimer les accents des noms de d√©partements
  nom_sans_accents <- chartr(" √°√†√¢√§√£√•√©√®√™√´√≠√¨√Æ√Ø√≥√≤√¥√∂√µ√∫√π√ª√º√±√ß'", "-aaaaaaeeeeiiiiooooouuuunc-", properties$nom)
  
  # G√©n√©rer l'URL pour l'image du logo du d√©partement
  image_url <- paste0("https://www.regions-et-departements.fr/images/logos-departements/",
                      properties$code_insee,
                      "-logo-",
                      tolower(nom_sans_accents),
                      ".png")
  
  # Remplacer les URLs pour les d√©partements sp√©cifiques (971, 972, 973, 974)
  special_departments <- properties$code_insee %in% c("971", "972", "973", "974")
  image_url[special_departments] <- paste0("https://www.regions-et-departements.fr/images/logos-departements/",
                                           properties$code_insee[special_departments],
                                           "-logo-departement-",
                                           tolower(nom_sans_accents[special_departments]),
                                           ".png")

  # Construire le contenu de la popup avec l'URL d'image dynamique
  paste0(
    "<div style='text-align:center;line-height: 0.6;'>",
    "<h3 style='margin-bottom: 10px;'>Informations sur le d√©partement</h3>",
    "<hr style='margin-top: 5px; margin-bottom: 5px; border-top: 1px solid #ccc;'>",
    "<div style='margin-top: 15px;'><img src='", image_url, "' style='width: auto; height: 70px;max-width: 200px;'></div>",
    "<p><strong>D√©partement :</strong> ", properties$code_insee, "</p>",
    "<p><strong>Population :</strong> ", format(properties$pop, big.mark = " ")," habitants", "</p>", # Formater pour meilleure lisibilit√©
    "<p><strong>Aire :</strong> ", format(round(properties$aires), big.mark = " ")," km&sup2", "</p>", # Formater pour meilleure lisibilit√©
    "<p><strong>Densit√© :</strong> ", format(round(properties$Densit√©), big.mark = " ")," hab/km&sup2", "</p>", # Formater pour meilleure lisibilit√©
    "<hr style='margin-top: 5px; margin-bottom: 5px; border-top: 1px solid #ccc;'>",
    "<p><strong> Nombre d'infrastructures de ", object, " : </strong> ", format(round(object2), big.mark = " "),"", "</p>", # Formater pour meilleure lisibilit√©
    "<p><strong> √Çge moyen des infrastructures : </strong> ", round(object4)," ans", "</p>", # Formater pour meilleure lisibilit√©
    "<p><strong> Nombre de licenci√©s : </strong> ", format(round(object3), big.mark = " "),"", "</p>", # Formater pour meilleure lisibilit√©
    "<p><strong> Nombre de licenci√©s/infrastructure : </strong> ", format(round(object3/object2), big.mark = " "),"", "</p>", # Formater pour meilleure lisibilit√©
    "</div>"
  )
}
```



<!-- ####################################################################### -->



<!-- Premi√®re page -->
# **Pr√©sentation du projet** {data-icon="fa-home"}


<!-- Premi√®re ligne -->
### **Pr√©sentation du projet :**


<!-- Mise en forme du texte -->
<div style="display: flex; justify-content: space-between; align-items: center; padding-bottom: 20px; font-family: "Roboto", sans-serif; border-bottom: 2px solid #ccc;">
  <div>
    <div style="font-size: 36px; color: #333; font-weight: bold;">Projet visualisation</div>
    <div style="font-size: 30px; color: #333;">Analyse de la corr√©lation entre les √©quipements sportifs et le nombre de licenci√©s</div>
  </div>
  <div style="font-family: "Roboto", sans-serif; color: #999; text-align: right;">
    <div style="margin-bottom: 3px;">LE GOURRIEREC Titouan</div>
    <div style="margin-bottom: 3px;">BERTIEAUX Laura</div>
    <div style="margin-bottom: 3px;">DUMAS Paul</div>
    <div style="margin-bottom: 3px;">HOLLECOU Enora</div>
  </div>
</div>
<hr style="margin-top: 0px; border: none; border-top: 1px solid #ccc;">
<p style="font-family: "Open Sans", sans-serif; font-size: 22px; color: #444; text-align: justify; line-height: 1.6;">
La crise sanitaire d√©clench√©e par la pand√©mie de Covid-19 a engendr√© un profond changement dans les habitudes sportives des Fran√ßais. Une tendance notable est l'essor de la pratique sportive √† domicile, au d√©triment des activit√©s traditionnelles dans les infrastructures d√©di√©es.<br><br>

Face √† ces transformations soci√©tales, le gouvernement fran√ßais se trouve confront√© √† la <strong>n√©cessit√© de r√©viser ses politiques d'investissement dans le domaine sportif</strong>. C'est dans cette perspective que nous avons d√©velopp√© ce tableau de bord. Son objectif principal est de fournir au gouvernement un <strong>instrument d'analyse efficace pour identifier et prioriser les zones n√©cessitant de nouveaux investissements en mati√®re d'√©quipements sportifs</strong>.<br><br>

Ce projet offre une utilit√© multiple en permettant une analyse fine des tendances √©mergentes en mati√®re de pratiques sportives. En int√©grant des donn√©es d√©mographiques et g√©ographiques, le tableau de bord offre une vision globale des besoins des citoyens en termes d'infrastructures sportives. Son objectif est d'am√©liorer la prise de d√©cision en mati√®re d'investissement dans le domaine sportif. Gr√¢ce √† des outils de visualisation avanc√©s et √† des donn√©es actualisables, le gouvernement dispose d'une feuille de route claire pour allouer efficacement les ressources en fonction des besoins changeants des citoyens.<br><br>

En somme, ce tableau de bord repr√©sente un outil essentiel pour <strong>accompagner le gouvernement fran√ßais dans sa mission de r√©pondre aux √©volutions des pratiques sportives et d'assurer un acc√®s √©quitable aux infrastructures sportives pour tous les citoyens</strong>, contribuant ainsi au bien-√™tre et √† la sant√© de la population.<br><br>

<span style="color: grey;"><strong>Les codes permettant la r√©cup√©ration de nos donn√©es sont accessibles en cliquant sur le bouton GitHub situ√© en bas √† droite.</strong></span> <br><br>
</p>


```{r bouton t√©l√©chargement donn√©es}

ui <- fluidPage(
  tags$head(
    tags$style(
      HTML(
        "
        /* Styles pour les boutons */
        .download-button, .github-button {
          background-color: #444444; /* Couleur de fond */
          border: none;
          color: white; /* Couleur du texte */
          padding: 15px 15px;
          text-align: center;
          text-decoration: none;
          display: inline-block;
          font-size: 16px;
          margin: 4px 2px;
          cursor: pointer;
          border-radius: 10px; /* Bord arrondi */
          transition: background-color 0.5s ease; /* Transition sur le survol */
        }

        /* Changement de couleur au survol */
        .download-button:hover, .github-button:hover {
          background-color: #000000;
          color: white; /* Couleur du texte au survol */
        }
        "
      )
    )
  ),
  fluidRow(
    div(class = "col-xs-6",
      downloadButton("downloaddata", "T√©l√©charger les donn√©es", class = "download-button") # Bouton de t√©l√©chargement
    ),
    div(class = "col-xs-6 text-right",
      actionButton("githublink", label = icon("github"), class = "github-button", onclick = "window.open('https://github.com/titouanlegourrierec/MissionR-D')"),
    )
  )
)

server <- function(input, output, session) {
  output$downloaddata <- downloadHandler(
    filename = function() {
      "carte_sport.csv"
    },
    content = function(file) {
      # √âcriture du dataframe carte_sport dans un fichier CSV (assumons que carte_sport est d√©j√† d√©fini)
      export <- st_drop_geometry(carte_sport) # Supprimer la g√©om√©trie du dataframe
      write.csv(export, file, row.names = FALSE) # √âcrire le dataframe dans un fichier CSV sans inclure les num√©ros de ligne
    }
  )
}

shinyApp(ui, server)

```



<!-- ################################################################################################## -->



<!-- Deuxi√®me page -->
# Les donn√©es {data-icon="fa-database"}

<!-- Premi√®re colonne -->
Column {.tabset}
-------------------------------------
   
### üéØ D√©marche

<div style="display: flex; justify-content: space-between; align-items: center; padding-bottom: 20px; font-family: 'Roboto', sans-serif; border-bottom: 2px solid #ccc;">
  <h1 style="font-size: 30px; color: #333; margin: 0;"><strong>D√©marche et int√©r√™t du projet :</strong></h1>
</div>
<hr style="margin-top: 0px; border: none; border-top: 1px solid #ccc;">
<p style="font-family: 'Open Sans', sans-serif; font-size: 22px; color: #444; text-align: justify; line-height: 1.6;">
Le projet vise √† √©tudier la corr√©lation entre le nombre de licenci√©s et le nombre d'infrastructures sportives pour les <strong>10 sports les plus pratiqu√©s en France</strong>, dans l'ordre : football, tennis, √©quitation, basket-ball, judo, handball, golf, natation, cano√´-kayak et rugby. <br><br>

En analysant ces donn√©es <strong>au niveau d√©partemental</strong>, l'objectif est d'aider le gouvernement √† <strong>prendre des d√©cisions √©clair√©es sur le financement des infrastructures sportives, afin de soutenir la pratique sportive dans les diff√©rentes r√©gions.</strong> <br><br>

Le projet vise √©galement √† √©tudier <strong>l'√©volution des licences</strong>, ainsi que la <strong>r√©partition par √¢ge et par sexe</strong> des licenci√©s. En examinant ces aspects en plus de la corr√©lation entre le nombre de licenci√©s et le nombre d'infrastructures sportives au niveau d√©partemental, l'objectif est de fournir des informations d√©taill√©es pour guider les d√©cisions de financement et d'investissement dans le sport, en tenant compte des <strong>variations d√©mographiques</strong> et des <strong>tendances dans la pratique sportive.</strong> <br><br><br><br>
</p>

![Source : Europe1](https://resize-europe1.lanmedia.fr/img/var/europe1/storage/images/media/images/fe-de-s-01-1/59787261-1-fre-FR/Fe-de-s-01-1.jpg){width=100%}
 
### Ô∏èüèü Les √©quipements sportifs

<div style="display: flex; justify-content: space-between; align-items: center; padding-bottom: 20px; font-family: 'Roboto', sans-serif; border-bottom: 2px solid #ccc;">
  <h1 style="font-size: 30px; color: #333; margin: 0;"><strong>R√©cup√©ration des donn√©es concernant les <u>infrastructures sportives</u> :</strong></h1>
  <img src="https://equipements.sports.gouv.fr/assets/theme_image/ministere_sjop.png" alt="Minist√®re" style="height: 110px; margin-left: 10px;">
</div>
<hr style="margin-top: 0px; border: none; border-top: 1px solid #ccc;">
<p style="font-family: 'Open Sans', sans-serif; font-size: 22px; color: #444; text-align: justify; line-height: 1.6;">
Nous avons utilis√© l'<strong>API "Data ES" fournie par le minist√®re des Sports et des Jeux Olympiques et Paralympiques</strong> pour collecter les donn√©es sur les infrastructures sportives. Cependant, il est √† noter que les infrastructures relatives √† l'<strong>√©quitation</strong> et au <strong>cano√´-kayak</strong> ne sont pas r√©pertori√©es dans cette API. Par cons√©quent, <strong>ces sports ont √©t√© exclus de notre √©tude.</strong><br><br>

Les donn√©es sur le <strong>nombre d'infrastructures</strong> par type et par d√©partement ont √©t√© r√©cup√©r√©es, puis regroup√©es selon les types d'infrastructures associ√©es √† chaque sport. Par exemple, les bassins sportifs, ludiques et mixtes sont regroup√©s pour la natation, les parcours de 18 trous, de 9 trous et les practice sont regroup√©s pour le golf, tandis que les gymnases multisports contribuent √† la fois au basketball et au handball.<br><br>

Parall√®lement, nous avons √©galement collect√© l'<strong>√¢ge moyen des infrastructures</strong>, class√©es par sport et par d√©partement, afin d'enrichir notre analyse. Cependant, nous avons ici la date de cr√©ation des √©quipements, l'API donnait √©galement des donn√©es sur les derniers travaux mais ne connaissant pas l'ampleur des modifications apport√©es, nous avons pr√©f√©r√© ne pas les prendre en compte.<br><br>

<strong>Ces informations sont r√©f√©renc√©es dans les colonnes `"Infrastructures-[sport]"` et `"AgeInfrastructures_[sport]"` de la base de donn√©es associ√©e.</strong><br><br>
</p>

[(Lien vers l'API utilis√©e pour les donn√©es concernant les infrastructures)](https://equipements.sports.gouv.fr/explore/dataset/data-es/api/)<br>
<span style="color: grey;">Derni√®re Mise √† jour des donn√©es : 10/03/2024, 6:50</span>

### Ô∏è‚úçÔ∏è Les donn√©es sur les licences

<div style="display: flex; justify-content: space-between; align-items: center; padding-bottom: 20px; font-family: 'Roboto', sans-serif; border-bottom: 2px solid #ccc;">
  <h1 style="font-size: 30px; color: #333; margin: 0;"><strong>R√©cup√©ration des donn√©es concernant les <u>Licences sportives</u> :</strong></h1>
  <img src="https://images.jifo.co/29899086_1588001850348.jpg" alt="Minist√®re" style="height: 110px; margin-left: 10px;">
</div>
<hr style="margin-top: 0px; border: none; border-top: 1px solid #ccc;">
<p style="font-family: 'Open Sans', sans-serif; font-size: 22px; color: #444; text-align: justify; line-height: 1.6;">
Nous avons obtenu les donn√©es sur les <strong>licences sportives</strong> √† partir d'un <strong>fichier CSV t√©l√©charg√© depuis le site internet de l'INJIEP</strong> (Institut National de la Jeunesse et de l'Education Populaire). Ce fichier regroupe le <strong>nombre de licences par sport, par √¢ge et par d√©partement</strong>, ainsi que l'<strong>√©volution du nombre de licences</strong> pour tous les sports de 2016 √† 2020.<br><br>

Pour notre √©tude, nous avons effectu√© un processus de <strong>filtrage</strong> afin de s√©lectionner uniquement les donn√©es relatives aux 8 sports qui nous int√©ressent. Ensuite, nous avons regroup√© les licences par <strong>sexe (H/F)</strong> et les avons r√©parties en <strong>4 tranches d'√¢ge (Enfants : 1-13 ans, Jeunes : 14-20 ans, Adultes : 21-55 ans, Seniors : 56-99 ans)</strong>, ce qui nous permet d'examiner √©galement l'<strong>aspect d√©mographique</strong> et les <strong>tendances</strong> associ√©es √† ces sports.<br><br>

<strong>Ces informations sont r√©f√©renc√©es dans les colonnes `"[sport] [tranche d'√¢ge] [sexe]"` de la base de donn√©es associ√©e.</strong><br><br>
</p>

[(Lien vers les donn√©es concernant les licences)](https://injep.fr/donnee/recensement-des-licences-et-clubs-sportifs-2022/)<br>
<span style="color: grey;">Derni√®re Mise √† jour des donn√©es : 27/09/2023</span>

### Ô∏è‚úçÔ∏è Les donn√©es sur la population

<div style="display: flex; justify-content: space-between; align-items: center; padding-bottom: 20px; font-family: 'Roboto', sans-serif; border-bottom: 2px solid #ccc;">
  <h1 style="font-size: 30px; color: #333; margin: 0;"><strong>R√©cup√©ration des donn√©es concernant les <u>populations d√©partementales</u> :</strong></h1>
  <img src="https://upload.wikimedia.org/wikipedia/fr/thumb/1/10/Logo_Insee.svg/1200px-Logo_Insee.svg.png" alt="Minist√®re" style="height: 110px; margin-left: 10px;">
</div>
<hr style="margin-top: 0px; border: none; border-top: 1px solid #ccc;">
<p style="font-family: 'Open Sans', sans-serif; font-size: 22px; color: #444; text-align: justify; line-height: 1.6;">
Pour obtenir des donn√©es sur les <strong>populations d√©partementales</strong>, ainsi que <strong>les codes et les noms des d√©partements</strong>, nous avons utilis√© une <strong>technique de Web Scraping</strong> sur le site de l'INSEE (Institut National de la Statistique et des √âtudes √âconomiques).<br><br>

<strong>Ces informations sont r√©f√©renc√©es dans les colonnes `"code_insee"`, `"nom"`, `"pop"` de la base de donn√©es associ√©e.</strong><br><br>
</p>

[(Lien vers les donn√©es concernant les populations)](https://www.insee.fr/fr/statistiques/6683015?sommaire=6683037)<br>
<span style="color: grey;">Derni√®re Mise √† jour des donn√©es : 29/12/2022</span>


<!-- Deuxi√®me colonne -->
Column
-------------------------------------

### Les donn√©es :

```{r Affichage des donn√©es}
datatable(carte_sport, options = list(pageLength = 100))
```






<!-- ################################################################################################## -->





# Explication de l'outil {data-icon="fa-question"}

## colonne 1

### Page : Analyse des donn√©es √† l'√©chelle nationale

<img src="./images/page1.png" style="margin-right: 20px; width: auto; height: 425px;">

### Page : Analyse des donn√©es √† l'√©chelle du d√©partement

<img src="./images/page2.png" style="margin-right: 20px; width: auto; height: 425px;">

## colonne 2

### <strong>Explications de la page "Analyse des donn√©es √† l'√©chelle nationale"</strong>

<p style="margin: 0;">
(1) <strong>Choix du sport</strong> pour l'affichage de l'√©volution des licences et des donn√©es compl√©mentaires.<br><br>
(2) Diagramme circulaire repr√©sentant la <strong>r√©partition des infrastructures</strong> par sport sur l'ensemble de la France.<br><br>
(3) Diagramme circulaire repr√©sentant la <strong>r√©partition des licenci√©s</strong> par sport sur l'ensemble de la France.<br><br>
(4) Graphe de l'<strong>√©volution du nombre de licenci√©s</strong> pour le sport s√©lectionn√© sur l'ensemble de la France de 2016 √† 2022.<br><br>
(5) Informations compl√©mentaires sur :<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - Le <strong>nombre total d'infrastructures</strong> du sport s√©lectionn√© sur l'ensemble de la France.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - Le <strong>nombre moyen d'infrastructures par d√©partement</strong>.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - L'<strong>√¢ge moyen des infrastructures</strong>.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - Le <strong>nombre de licenci√©s</strong>.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - La <strong>proportion de femmes</strong> parmi les licenci√©s.
</p>
<hr style="margin-top: 0px; border: none; border-top: 1px solid #ccc;">
<p style="margin: 0;">
<strong>Exemple d'interpr√©tation de (4) :</strong> Cette visualisation met en √©vidence les fluctuations de la pratique sportive en club avant et apr√®s la crise du Covid-19. Une baisse significative est observ√©e entre 2020 et 2021, correspondant √† la crise du Covid, suivie d'une nette augmentation post√©rieure √† 2021. Cette hausse pourrait n√©cessiter l'installation de nouvelles infrastructures sportives pour r√©pondre √† la demande croissante. De plus, il est remarqu√© que tous les sports n‚Äôont pas √©t√© affect√©s de la m√™me mani√®re ; par exemple, le golf semble avoir √©t√© peu touch√© par la crise du Covid-19.
</p>

### <strong>Explications de la page "Analyse des donn√©es √† l'√©chelle du d√©partement"</strong>

<p style="margin: 0;">
(1) Le <strong>choix du sport</strong> et l'<strong>affichage</strong> entra√Æne une modification de la carte (2), tandis que le <strong>choix du d√©partement</strong> entra√Æne des modifications sur les informations compl√©mentaires de r√©partition par sexe (3) et de r√©partition par tranches d'√¢ge (4).<br><br>
(2) <strong>Carte de la France</strong> repr√©sentant les donn√©es et le sport choisis avec (1).<br><br>
(3) Diagramme circulaire repr√©sentant la <strong>r√©partition des licenci√©s par sexe</strong> dans le d√©partement et le sport choisi en (1).<br><br>
(4) Diagramme en barres repr√©sentant la <strong>r√©partition des licenci√©s par tranche d'√¢ge</strong> dans le d√©partement et le sport choisi en (1).<br><br>
</p>
<hr style="margin-top: 0px; border: none; border-top: 1px solid #ccc;">
<p style="margin: 0;">
<strong>Exemple d'interpr√©tation :</strong> <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -En utilisant <strong>la carte (2)</strong> et en s√©lectionnant Licences/infrastructures avec (1), on peut observer √† quel point les infrastructures sont surcharg√©es. En compl√©ment, examiner l'√¢ge des infrastructures dans ce d√©partement permet de d√©terminer si la r√©novation ou la construction de nouvelles infrastructures est une priorit√© urgente. <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- Le <strong>diagramme circulaire (3)</strong> facilite l'adaptation des infrastructures sportives aux diff√©rents profils de pratiquants, en prenant en consid√©ration les besoins sp√©cifiques de chaque sexe. <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- Quant au <strong>diagramme en barres (4)</strong>, il fournit des informations sur l'√¢ge des pratiquants afin d'orienter les investissements. Il pourrait √™tre judicieux de concentrer les investissements dans les sports attrayants pour les jeunes afin de promouvoir la pratique sportive au sein de cette population.
</p>




<!-- ################################################################################################## -->





<!-- Trois√®me page -->
# Analyse des donn√©es √† l'√©chelle nationale {data-icon="fa-globe"}

<!-- Premi√®re colonne -->
## colonne 1

<!-- Premi√®re case -->
### Choix du sport {data-height="110"}

```{r Boutons choix sport}
radioButtons(
  "sport5",  # Nom utilis√© pour acc√©der √† la valeur s√©lectionn√©e
  label = "Choix du sport :",  # Texte affich√© au-dessus des boutons radio
  choices = c("Football", "Basketball", "Handball", "Rugby", "Tennis", "Judo", "Golf", "Natation"),  # Options disponibles pour les boutons radio
  selected = "Football",  # Valeur initialement s√©lectionn√©e
  inline = TRUE,  # Indique si les boutons radio doivent √™tre affich√©s en ligne ou en colonne
  choiceNames = c("Football", "Basketball", "Handball", "Rugby", "Tennis", "Judo", "Golf", "Natation"),  # Noms des choix affich√©s √† l'utilisateur
  choiceValues = c("Football", "Basketball", "Handball", "Rugby", "Tennis", "Judo", "Golf", "Natation")  # Valeurs des choix renvoy√©es lorsque l'utilisateur s√©lectionne une option
)
```

<!-- Deuxi√®me case -->
### R√©partition des infrastructures sportives par sport
```{r R√©partition des infrastructures sportives par sport}
# Calcul du total des infrastructures pour tous les sports
total_infra <- carte_sport$Infrastructures_Football + carte_sport$Infrastructures_Tennis + carte_sport$Infrastructures_Basketball + carte_sport$Infrastructures_Handball + carte_sport$Infrastructures_Natation + carte_sport$Infrastructures_Rugby + carte_sport$Infrastructures_Golf

# Noms des sports pour les √©tiquettes du camembert
sport_names <- c("Infrastructures_Football", "Infrastructures_Tennis", "Infrastructures_Basketball", "Infrastructures_Handball", "Infrastructures_Natation", "Infrastructures_Rugby", "Infrastructures_Golf")

# Calcul du nombre d'infrastructures pour chaque sport
sport_counts <- sapply(sport_names, function(sport) sum(carte_sport[[sport]]))

# D√©finition des couleurs pour chaque sport
colors <- c("#EAD2AC", "#AA9ABA", "#63A088", "#264653", "#34403A", "#E8DB7D", "#5B3000")

# Cr√©ation du graphique en secteurs (camembert) interactif avec gestion des couleurs
plot_ly(
  labels = sport_names,  # √âtiquettes des secteurs
  values = sport_counts,  # Valeurs des secteurs
  type = 'pie',  # Type de graphique : camembert
  textinfo = 'percent',  # Informations textuelles √† afficher (pourcentage)
  marker = list(colors = colors)  # D√©finition des couleurs des secteurs
)
```

<!-- Trois√®me case -->
### R√©partition des Licences sportives par sport
```{r}
# Calcul du total des licences pour tous les sports
total_licences <- carte_sport$Licences_Football + carte_sport$Licences_Tennis + carte_sport$Licences_Basketball + carte_sport$Licences_Handball + carte_sport$Licences_Natation + carte_sport$Licences_Rugby + carte_sport$Licences_Golf

# Noms des sports pour les √©tiquettes du camembert
sport_names <- c("Licences_Football", "Licences_Tennis", "Licences_Basketball", "Licences_Handball", "Licences_Natation", "Licences_Rugby", "Licences_Golf")

# Calcul du nombre de licences pour chaque sport en utilisant la fonction sapply()
sport_counts <- sapply(sport_names, function(sport) sum(carte_sport[[sport]]))

# D√©finition des couleurs pour chaque sport
colors <- c("#EAD2AC", "#AA9ABA", "#63A088", "#264653", "#34403A", "#E8DB7D", "#5B3000")

# Cr√©ation du graphique en secteurs (camembert) interactif avec gestion des couleurs
plot_ly(
  labels = sport_names,  # √âtiquettes des secteurs
  values = sport_counts,  # Valeurs des secteurs
  type = 'pie',  # Type de graphique : camembert
  textinfo = 'percent',  # Informations textuelles √† afficher (pourcentage)
  marker = list(colors = colors)  # D√©finition des couleurs des secteurs
)
```


<!-- Deuxi√®me colonne -->
## colonne 2

<!-- Premi√®re case -->
### Evolution des Licences

```{r Evolution des Licences}
# Cr√©er un dataframe avec les donn√©es fournies
data <- evolution

renderPlotly({
  # Extraire les donn√©es pour le sport s√©lectionn√©
  sport_data <- data[data$Sport == input$sport5, -1]  # S√©lection des donn√©es pour le sport choisi, excluant la colonne de noms de sport
  rownames(sport_data) <- data[data$Sport == input$sport5, 1]  # D√©finir les noms de ligne comme les noms des sports
  
  # Retirer le "X" des ann√©es pour les utiliser comme libell√©s d'axe
  years <- gsub("X", "", colnames(sport_data))
  
  # Cr√©er un graphique avec Plotly avec des lignes et des points plus gros
  p <- plot_ly(sport_data, x = years, y = as.numeric(sport_data), type = 'scatter', mode = 'lines', name = 'Football', 
               line = list(width = 5, color='#444444'),  # D√©finir la largeur et la couleur de la ligne
               text = paste("<span style='font-family: Helvetica; font-size:15px; '><b>Sport :</b> Football",
                            "<br><b>Ann√©e :</b> ", years,
                            "<br><b>Licences :</b> ", format(as.numeric(sport_data), big.mark = " ", scientific = FALSE),
                            "</span>"),  # D√©finir le texte √† afficher lors du survol
               hoverinfo = 'text'  # D√©finir les informations √† afficher lors du survol
  ) %>%
    layout(title = paste0('√âvolution des licences de ', input$sport5 ,' (2016-2022)'),  # D√©finir le titre du graphique
           xaxis = list(title = 'Ann√©e'),  # D√©finir le titre de l'axe des x
           yaxis = list(title = 'Licences de Football', rangemode = "tozero")) %>%  # D√©finir le titre de l'axe des y et le mode du range
    add_segments(x = 2020, xend = 2020, y = 0, yend = max(as.numeric(sport_data)),  # Ajouter un segment pour indiquer l'ann√©e 2020 (covid)
                 line = list(color = "#BB0F0F", width = 4, dash = "dot"))  # D√©finir les propri√©t√©s du segment
  
  # Ajouter une annotation pour indiquer la p√©riode de la pand√©mie de Covid-19
  p <- layout(p, 
              annotations = list(
                list(x = 2020, y = max(as.numeric(sport_data)), 
                     text = "<b>Covid 19</b>",
                     showarrow = FALSE,
                     font = list(size = 15, color = "#BB0F0F"),  # D√©finir la taille et la couleur du texte
                     xshift = 30, yshift = 20)  # D√©finir le d√©calage du texte par rapport au point d'annotation
              ))
})

```


### üèüÔ∏è Nombre d'infrastructures du sport s√©lectionn√© :{data-height=50}

```{r}
renderValueBox({

x <- paste0('Infrastructures_',input$sport5)
object <- sum(carte_sport[[x]])
  

valueBox(format(object, big.mark = " "), color = "#A6C9BB")
})
```

### üèü Nombre moyen d'infrastructures par d√©partement :

```{r}
renderValueBox({

x <- paste0('Infrastructures_',input$sport5)
object <- round(mean(carte_sport[[x]]))
  

valueBox(object, color = "#D2B6B1")
})
```

### ‚è±Ô∏è Age moyen des infrastructures

```{r}
renderValueBox({

x <- paste0('AgeInfrastructures_',input$sport5)
object <- round(mean(carte_sport[[x]]))
  

valueBox(object, color = "#999EC2")
})
```

### üèÉ Nombre de licenci√©s :

```{r}
renderValueBox({
  
  Licenci√©s_Hommes <- grep(paste0("^",input$sport5, ".*H$"), names(carte_sport), value = TRUE)
  Licenci√©es_Femmes <- grep(paste0("^",input$sport5, ".*F$"), names(carte_sport), value = TRUE)
  
  Licenci√©s_Hommes <- st_drop_geometry(carte_sport[, Licenci√©s_Hommes])
  Licenci√©es_Femmes <- st_drop_geometry(carte_sport[, Licenci√©es_Femmes])
  
  sum <- sum(unlist(Licenci√©s_Hommes)) + sum(unlist(Licenci√©es_Femmes))

valueBox(format(sum, big.mark = " "), color = "#E67D60")
})
```

### üö∫ Proportion de femmes (en %) :

```{r}
renderValueBox({
  
  Licenci√©s_Hommes <- grep(paste0("^",input$sport5, ".*H$"), names(carte_sport), value = TRUE)
  Licenci√©es_Femmes <- grep(paste0("^",input$sport5, ".*F$"), names(carte_sport), value = TRUE)
  
  Licenci√©s_Hommes <- st_drop_geometry(carte_sport[, Licenci√©s_Hommes])
  Licenci√©es_Femmes <- st_drop_geometry(carte_sport[, Licenci√©es_Femmes])
  
  sum <- sum(unlist(Licenci√©es_Femmes))
  sums <- sum(unlist(Licenci√©s_Hommes)) + sum(unlist(Licenci√©es_Femmes))

valueBox(format(round((sum/sums)*100), big.mark = " "), color = "#CD8EA6")
})
```



<!-- ################################################################################################## -->




# Analyse des des donn√©es √† l'√©chelle du d√©partement {data-icon="fa-magnifying-glass-chart"}

## Column {data-width="600"}

### '


```{r Carte Leaflet test zoom}
renderUI({

red_palette <- colorRampPalette(c("#FFF4C2", "#BB0F0F"))
colors <- red_palette(10)

# Obtenir les limites g√©ographiques de la zone o√π code_insee="01"
#bounds <- st_bbox(carte_sport[carte_sport$code_insee == input$dep, ])

#object <- carte_sport[[input$sport2]]

if (input$mode == 'Infrastructures'){
  x <- paste0('Infrastructures_',input$sport2)
  object <- carte_sport[[x]]
} else if (input$mode == 'Licences'){
  x <- paste0('Licences_',input$sport2)
  object <- carte_sport[[x]]
} else if (input$mode == 'Licences/Infrastructures') {
  x <- paste0('Licences_',input$sport2)
  y <- paste0('Infrastructures_',input$sport2)
  object <- carte_sport[[x]]/carte_sport[[y]]
} else if (input$mode == 'Licences/Population') {
  x <- paste0('Licences_',input$sport2)
  object <- carte_sport[[x]]/carte_sport$pop
} else if (input$mode == 'AgeInfrastructures') {
  x <- paste0('AgeInfrastructures_',input$sport2)
  object <- carte_sport[[x]]
}

# Create a Leaflet map with filtered French departments data
leaflet(carte_sport) %>%
  #fitBounds(lng1 = as.numeric(bounds['xmin']), lat1 = as.numeric(bounds['ymin']), lng2 = as.numeric(bounds['xmax']), lat2 = as.numeric(bounds['ymax'])) %>%
  fitBounds(lng1 = -5.745580, lat1 = 51.319823, lng2 = 10.134413, lat2 = 41.108560) %>%
  addProviderTiles(providers$CartoDB.Positron) %>%
  addPolygons(color = ifelse(carte_sport$code_nom == input$dep, "black", "#444444") , weight = ifelse(carte_sport$code_nom == input$dep, 4, 1), # Change weight based on condition
              opacity = 0.8, fillOpacity = 0.75,
              fillColor = ~colorNumeric(colors, object)(object),
              highlightOptions = highlightOptions(color = "#444444",fillOpacity=0.5 , weight = 3, bringToFront = TRUE),
              popup=~popup_content(carte_sport, input$sport2)
  ) %>%
  addControl(
    html = "<div style='text-align:left; padding: 10px;'><strong>Sources</strong> : 
            <br>Population : <a href='https://www.insee.fr/fr/statistiques/6683015?sommaire=6683037' target='_blank'>INSEE</a>
            <br>Logos : <a href='https://www.regions-et-departements.fr/logos-departements-francais?utm_content=cmp-true' target='_blank'>R√©gions et D√©partements</a>
            <br>Licences sportives : <a href='https://injep.fr/donnee/recensement-des-licences-et-clubs-sportifs-2022/' target='_blank'>Injep</a>
            <br>Infrastructures : <a href='https://equipements.sports.gouv.fr/explore/dataset/data-es/information/?refine.carac159=Clubs+sportifs,+comit√©s,+ligues,+f√©d√©rations&dataChart=eyJxdWVyaWVzIjpbeyJjb25maWciOnsiZGF0YXNldCI6ImRhdGEtZXMiLCJvcHRpb25zIjp7fX0sImNoYXJ0cyI6W3siYWxpZ25Nb250aCI6dHJ1ZSwidHlwZSI6ImxpbmUiLCJmdW5jIjoiQVZHIiwieUF4aXMiOiJjb29yZGdwc3giLCJzY2llbnRpZmljRGlzcGxheSI6dHJ1ZSwiY29sb3IiOiIjNDY1RjlEIn1dLCJ4QXhpcyI6ImRhdGVfdmFsaWQiLCJtYXhwb2ludHMiOiIiLCJ0aW1lc2NhbGUiOiJ5ZWFyIiwic29ydCI6IiJ9XSwiZGlzcGxheUxlZ2VuZCI6dHJ1ZSwiYWxpZ25Nb250aCI6dHJ1ZX0%3D&location=16,44.13659,4.07664&basemap=c26ae9' target='_blank'>Minist√®re des sports</a></div>",
    position = "bottomleft"
  ) %>%
  addControl(
    #html = "<div class='map-title' style='text-align:center;'><h2>Map Title</h2></div>",
    html = paste0("<div class='map-title' style='text-align:center;'><h3><strong>Carte des infrastructures de ", input$sport2, " en France</strong></h3></div>"),
    position = "topright",
  ) %>%
  addLegend(
    position = "bottomright",
    colors = rev(colors),
    labels = c(as.character(format(max(object)), big.mark = " "), "", "", "", "", format((max(object)-min(object))/2, big.mark = " "), "", "", "", as.character(format(min(object)), big.mark = " ")),
    opacity = 0.8
  )

}) 

```

## dep {data-width="400"}

### Param√®tres {data-height="400"}

**Vous pouvez changer le sport affich√© sur la carte de la France √† l'aide du bouton `'Sport'` ou choisir les donn√©es affich√©es √† l'aide des boutons `'Choix de l'affichage'`.**

---


```{r}
div(class = "row",
  div(class = "col-sm-6",
    selectInput("dep", "D√©partement", choices = carte_sport$code_nom)
  ),
  div(class = "col-sm-6",
    selectInput("sport2", "Sport", choices = c("Football", "Tennis", "Basketball", "Handball", "Golf", "Rugby", "Judo", "Natation"), selected = "Football")
  )
)
```


```{r}
radioButtons(
  "mode",
  label = "Choix de l'affichage :",
  choices = c("Infrastructures", "Licences", "Licences/Infrastructures", "Licences/Population", "AgeInfrastructures"),
  selected = "Infrastructures",
  inline = TRUE,
  #width = 200,
  choiceNames = c("Infrastructures", "Licenci√©s", "Licences/Infrastructures", "Licences/Population", "AgeInfrastructures"),
  choiceValues = c("Infrastructures", "Licences", "Licences/Infrastructures", "Licences/Population", "AgeInfrastructures")
)

```


### R√©partition des licenci√©s par sexe

```{r}
renderPlotly({
  departement <- subset(carte_sport, code_nom == input$dep)
  Licenci√©s_Hommes <- grep(paste0("^",input$sport2, ".*H$"), names(departement), value = TRUE)
  Licenci√©es_Femmes <- grep(paste0("^",input$sport2, ".*F$"), names(departement), value = TRUE)
  
  Licenci√©s_Hommes <- st_drop_geometry(departement[, Licenci√©s_Hommes])
  Licenci√©es_Femmes <- st_drop_geometry(departement[, Licenci√©es_Femmes])
  
  # Cr√©er un vecteur contenant les valeurs des colonnes "sport_H" et "sport_F"
  valeurs <- c(sum(Licenci√©s_Hommes), sum(Licenci√©es_Femmes))
  
  # Noms des sections
  noms_sections <- c("Licenci√©s Hommes", "Licenci√©es Femmes")
  
  # Couleurs personnalis√©es
  couleurs <- c("#3685B5", "#F03A47") # Bleu pour les hommes, orange pour les femmes
  
  plot_ly(labels = noms_sections, values = valeurs, type = 'pie', textinfo = 'value+percent', hole = 0.5) %>%
    add_trace(marker = list(colors = couleurs))
})
```

### R√©partition des Licenci√©s par tranche d'√¢ge

```{r}

renderUI({
  carte_sport_filtr√© <- subset(carte_sport, code_nom == input$dep)
  sport <- input$sport2
  
  test <- paste0 
  
# D√©finir une palette de couleurs grises
couleurs_grises <- c("#3685B5", "#399E5A", "#F03A47", "#F2C078")

# Cr√©er le diagramme en barres interactif avec les donn√©es filtr√©es et le cumul√©
plot_ly(data = carte_sport_filtr√©, 
                y = ~ get(paste0(sport, " (1-13) H")) + get(paste0(sport, " (1-13) F")), type = 'bar', name = 'Enfant (1-13)', hoverinfo = 'text',
            text = paste("<b>Nombre de pratiquants (Enfants 1-13) :</b><br>", format(carte_sport_filtr√©[[paste0(sport, ' (1-13) H')]] + carte_sport_filtr√©[[paste0(sport, ' (1-13) F')]], big.mark = " ")),
            insidetextfont = list(color = 'rgba(0,0,0,0)', size = 0), marker = list(color = couleurs_grises[1])) %>%
  add_trace(y = ~ get(paste0(sport, " (14-20) H")) + get(paste0(sport, " (14-20) F")), type = 'bar', name = 'Jeune (14-20)', hoverinfo = 'text',
            text = paste("<b>Nombre de pratiquants (Jeunes 14-20) :</b><br>", format(carte_sport_filtr√©[[paste0(sport, ' (14-20) H')]] + carte_sport_filtr√©[[paste0(sport, ' (14-20) F')]], big.mark = " ")),
            insidetextfont = list(color = 'rgba(0,0,0,0)', size = 0), marker = list(color = couleurs_grises[2])) %>%
  add_trace(y = ~ get(paste0(sport, " (21-55) H")) + get(paste0(sport, " (21-55) F")) , type = 'bar', name = 'Adultes (21-55)', hoverinfo = 'text',
            text = paste("<b>Nombre de pratiquants (Adultes 21-55) :</b><br>", format(carte_sport_filtr√©[[paste0(sport, ' (21-55) H')]] + carte_sport_filtr√©[[paste0(sport, ' (21-55) F')]], big.mark = " ")),
            insidetextfont = list(color = 'rgba(0,0,0,0)', size = 0), marker = list(color = couleurs_grises[3])) %>%
  add_trace(y = ~ get(paste0(sport, " (56-99) H")) + get(paste0(sport, " (56-99) F")), type = 'bar', name = 'Senior (56-99)', hoverinfo = 'text',
            text = paste("<b>Nombre de pratiquants (Seniors 56-99) :</b><br>", format(carte_sport_filtr√©[[paste0(sport, ' (56-99) H')]] + carte_sport_filtr√©[[paste0(sport, ' (56-99) F')]], big.mark = " ")),
            insidetextfont = list(color = 'rgba(0,0,0,0)', size = 0), marker = list(color = couleurs_grises[4])) %>%
  layout(#title = "R√©partition des licenci√©s par cat√©gorie d'√¢ge",
         xaxis = list(title = "Tranches d'√¢ge", showticklabels = FALSE),
         yaxis = list(title = 'Nombre de licenci√©s'))

})
```









# Mentions l√©gales {data-icon="fa-scale-unbalanced"}

### Populations (INSEE) : https://www.insee.fr/fr/information/2381863

![](./images/INSEE.png)

### Equipements sportifs (data.gouv) : https://github.com/etalab/licence-ouverte/blob/master/LO.md


![](./images/ES.png)

### licences sportives (INJIEP) : https://injep.fr/mentions-legales/

![](./images/INJIEP.png)




